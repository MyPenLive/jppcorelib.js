(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_=[].slice,D={}.hasOwnProperty,P=function(e,t){function r(){this.constructor=e}for(var n in t)D.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},H=function(e,t){return function(){return e.apply(t,arguments)}};y=function(){function e(t){return e._validatePath(t)?new M(t):_printError("Namespace('"+t+"'), '"+t+"' is invalid.")}return e._spaces={},e._separator=".",e._defaultScope=window,e._regSeparator=e._separator.match(/[\[\]\-^$.+*?{}\\]/)!==null?"\\"+e._separator:e._separator,e._regPath=new RegExp("^[0-9a-zA-Z]+("+e._regSeparator+"[0-9a-zA-Z]+)*$"),e._getSpace=function(t){return e._spaces[t]},e._setSpace=function(t){var n,r;return(r=(n=e._spaces)[t])!=null?r:n[t]={}},e._existSpace=function(t){return e._spaces[t]!=null},e._validatePath=function(t){return t!=null&&e._regPath.test(t)},e._print=function(e){return typeof console!="undefined"&&console!==null?typeof console.log=="function"?console.log(e):void 0:void 0},e._printError=function(t,n){return e._print("###ERROR### at "+t+" : "+n)},e.enumerate=function(){return e._print(e._spaces)},e}(),M=function(){function e(e){this._path=e,this._names=this._path.split(y._separator),this._space=y._getSpace(this._path),this._scope=y._defaultScope}return e.prototype.register=function(e,t,n){return n==null&&(n=!1),e==null||t==null?(y._printError("Namespace('"+this._path+"').register","one of arguments is not defined"),this):(this._allocate(),n||this._space[e]==null?(this._space[e]=t,this):(y._printError("Namespace('"+this._path+"').register","'"+e+"' is already registered."),this))},e.prototype["import"]=function(e){var t,n,r,i,s;e==null&&(e="*"),this._allocate();if(e==="*"){s=this._space;for(t in s)n=s[t],this._extern(t);return this}if(e instanceof Array){for(r=0,i=e.length;r<i;r++)t=e[r],this._extern(t);return this}return this._space[e]!=null?(this._extern(e),this):(y._printError("Namespace('"+this._path+"').import","'"+e+"' is not defined"),this)},e.prototype.exist=function(){return y._existSpace(this._path)},e.prototype.use=function(){var e,t,n,r,i,s,o,u,a;this._allocate(),n=this._scope,o=this._names;for(i=0,s=o.length;i<s;i++)t=o[i],n=(u=n[t])!=null?u:n[t]={};a=this._space;for(e in a)r=a[e],n[e]=r;return this},e.prototype.scope=function(e){return e==null&&(e=y._defaultScope),this._scope=e,this},e.prototype.getPath=function(){return this._path},e.prototype._allocate=function(){var e,t,n;if(y._existSpace(this._path))return;this._space=y._setSpace(this._path),t=this._names.length,e=1,n=[];while(e<t)y._setSpace(this._names.slice(0,e).join(".")),n.push(++e);return n},e.prototype._extern=function(e){return this._scope[e]=this._space[e]},e}(),y("jpp.util").register("Namespace",y).use(),u=function(){function e(){}return e.build=function(e,t){return t==null&&(t=""),new Error("Error at "+e+(t!==""?" : "+t:void 0))},e["throw"]=function(t,n){throw n==null&&(n=""),e.build(t,n)},e}(),y("jpp.util").register("Err",u),b=function(){function e(){}return e.PI=Math.PI,e.PI2=e.PI*2,e.PI_2=e.PI/2,e.PI_3=e.PI/3,e.PI_4=e.PI/4,e.PI_6=e.PI/6,e.toRadian=function(e){return e*PI/180},e.toDegree=function(e){return e*180/PI},e.dist=function(e,t,n){return n==null&&(n=!0),n?Math.sqrt(e*e+t*t):e*e+t*t},e.dist2=function(e,t,n,r,i){return i==null&&(i=!0),dist(n-e,r-t,i)},e.map=function(e,t,n,r,i){return e<t&&(e=t),e>n&&(e=n),(e-t)*(i-r)/(n-t)+r},e.internallyDividing=function(e,t,n,r){return e===t?e:(r*e+n*t)/(n+r)},e.externallyDividing=function(e,t,n,r){return e===t?e:(r*e-n*t)/(r-n)},e.sign=function(e){var t;return(t=e<0)!=null?t:-{1:1}},e.choose=function(){var e;return e=1<=arguments.length?_.call(arguments,0):[],e[Math.floor(Math.random()*e.length)]},e.combine=function(e,t,n,r){var i;return r==null&&(r=null),n>1?r==null&&(r=1):r==null&&(r=1-n),i=n+r,e*n/i+t*(1-n/i)},e.range=function(e,t){return Math.random()*(t-e)+e},e}(),y("jpp.util").register("Num",b),e=function(){function e(){}return e.sequence=function(e,t,n){var r,i;t==null&&(t=0),n==null&&(n=1),r=[],i=0;while(i<e)r[i]=i*n,++i;return r},e.choose=function(e,t){var n;return t==null&&(t=!1),n=Math.floor(Math.random()*e.length),t?e.splice(n,1)[0]:e[n]},e.shuffle=function(e,t){var n,r,i,s;t==null&&(t=!1),t&&(e=e.concat()),n=r=e.length;while(n--)i=Math.floor(Math.random()*n),s=e[n],e[n]=e[i],e[i]=s;return e},e.clone=function(e){return e.concat()},e}(),y("jpp.util").register("Arr",e),w=function(){function e(){}return e.clone=function(e){var t,n,r;t={};for(n in e)r=e[n],t[n]=r;return t},e}(),y("jpp.util").register("Obj",w),o=function(){function e(){}return e.Linear=function(e,t,n,r,i){return r*t/i+n},e.easeInQuad=function(e,t,n,r,i){return r*(t/=i)*t+n},e.easeOutQuad=function(e,t,n,r,i){return-r*(t/=i)*(t-2)+n},e.easeInOutQuad=function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t+n:-r/2*(--t*(t-2)-1)+n},e.easeInCubic=function(e,t,n,r,i){return r*(t/=i)*t*t+n},e.easeOutCubic=function(e,t,n,r,i){return r*((t=t/i-1)*t*t+1)+n},e.easeInOutCubic=function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t+n:r/2*((t-=2)*t*t+2)+n},e.easeInQuart=function(e,t,n,r,i){return r*(t/=i)*t*t*t+n},e.easeOutQuart=function(e,t,n,r,i){return-r*((t=t/i-1)*t*t*t-1)+n},e.easeInOutQuart=function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t+n:-r/2*((t-=2)*t*t*t-2)+n},e.easeInQuint=function(e,t,n,r,i){return r*(t/=i)*t*t*t*t+n},e.easeOutQuint=function(e,t,n,r,i){return r*((t=t/i-1)*t*t*t*t+1)+n},e.easeInOutQuint=function(e,t,n,r,i){return(t/=i/2)<1?r/2*t*t*t*t*t+n:r/2*((t-=2)*t*t*t*t+2)+n},e.easeInSine=function(e,t,n,r,i){return-r*Math.cos(t/i*(Math.PI/2))+r+n},e.easeOutSine=function(e,t,n,r,i){return r*Math.sin(t/i*(Math.PI/2))+n},e.easeInOutSine=function(e,t,n,r,i){return-r/2*(Math.cos(Math.PI*t/i)-1)+n},e.easeInExpo=function(e,t,n,r,i){return t===0?n:r*Math.pow(2,10*(t/i-1))+n},e.easeOutExpo=function(e,t,n,r,i){return t===i?n+r:r*(-Math.pow(2,-10*t/i)+1)+n},e.easeInOutExpo=function(e,t,n,r,i){return t===0?n:t===i?n+r:(t/=i/2)<1?r/2*Math.pow(2,10*(t-1))+n:r/2*(-Math.pow(2,-10*--t)+2)+n},e.easeInCirc=function(e,t,n,r,i){return-r*(Math.sqrt(1-(t/=i)*t)-1)+n},e.easeOutCirc=function(e,t,n,r,i){return r*Math.sqrt(1-(t=t/i-1)*t)+n},e.easeInOutCirc=function(e,t,n,r,i){return(t/=i/2)<1?-r/2*(Math.sqrt(1-t*t)-1)+n:r/2*(Math.sqrt(1-(t-=2)*t)+1)+n},e.easeInElastic=function(e,t,n,r,i){var s,o,u;return u=1.70158,o=0,s=r,t===0?n:(t/=i)===1?n+r:(o===0&&(o=i*.3),s<Math.abs(r)?(s=r,u=o/4):u=o/(2*Math.PI)*Math.asin(r/s),-s*Math.pow(2,10*(t-=1))*Math.sin((t*i-u)*2*Math.PI/o)+n)},e.easeOutElastic=function(e,t,n,r,i){var s,o,u;return u=1.70158,o=0,s=r,t===0?n:(t/=i)===1?n+r:(o===0&&(o=i*.3),s<Math.abs(r)?(s=r,u=o/4):u=o/(2*Math.PI)*Math.asin(r/s),s*Math.pow(2,-10*t)*Math.sin((t*i-u)*2*Math.PI/o)+r+n)},e.easeInOutElastic=function(e,t,n,r,i){var s,o,u;return u=1.70158,o=0,s=r,t===0?n:(t/=i/2)===2?n+r:(o===0&&(o=i*.3*1.5),s<Math.abs(r)?(s=r,u=o/4):u=o/(2*Math.PI)*Math.asin(r/s),t<1?-0.5*s*Math.pow(2,10*(t-=1))*Math.sin((t*i-u)*2*Math.PI/o)+n:s*Math.pow(2,-10*(t-=1))*Math.sin((t*i-u)*2*Math.PI/o)*.5+r+n)},e.easeInBack=function(e,t,n,r,i,s){return s==null&&(s=1.70158),r*(t/=i)*t*((s+1)*t-s)+n},e.easeOutBack=function(e,t,n,r,i,s){return s==null&&(s=1.70158),r*((t=t/i-1)*t*((s+1)*t+s)+1)+n},e.easeInOutBack=function(e,t,n,r,i,s){return s==null&&(s=1.70158),(t/=i/2)<1?r/2*t*t*(((s*=1.525)+1)*t-s)+n:r/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+n},e.easeInBounce=function(t,n,r,i,s){return i-e.easeOutBounce(t,s-n,0,i,s)+r},e.easeOutBounce=function(e,t,n,r,i){return(t/=i)<1/2.75?r*7.5625*t*t+n:t<2/2.75?r*(7.5625*(t-=1.5/2.75)*t+.75)+n:t<2.5/2.75?r*(7.5625*(t-=2.25/2.75)*t+.9375)+n:r*(7.5625*(t-=2.625/2.75)*t+.984375)+n},e.easeInOutBounce=function(t,n,r,i,s){return n<s/2?e.easeInBounce(t,n*2,0,i,s)*.5+r:e.easeOutBounce(t,n*2-s,0,i,s)*.5+i*.5+r},e}(),y("jpp.util").register("Easing",o),a=function(){function e(e,t,n){this.type=e,this.target=t,this.extra=n}return e.COMPLETE="complete",e.OPEN="open",e.CLOSE="close",e.ERROR="error",e.CANCEL="cancel",e.RESIZE="resize",e.INIT="init",e.CONNECT="connect",e.PROGRESS="progress",e.ADDED="added",e.REMOVED="removed",e.SELECT="select",e.FOCUS="focus",e.RENDER="render",e}(),y("jpp.event").register("Event",a),f=function(){function e(e){e==null&&(e=null),this._target=e!=null?e:this,this._listeners={}}return e.prototype.addEventListener=function(e,t){var n,r,i,s,o,u;if(typeof t!="function")return this;(o=(r=this._listeners)[e])==null&&(r[e]=[]),u=this._listeners[e];for(i=0,s=u.length;i<s;i++){n=u[i];if(n===t)return this}return this._listeners[e].push(t),this},e.prototype.removeEventListener=function(e,t){var n,r,i,s,o;if(!this.hasEventListener(e))return this;o=this._listeners[e];for(n=i=0,s=o.length;i<s;n=++i)r=o[n],r===t&&this._listeners[e].splice(n,1);return this._listeners[e].length===0&&delete this._listeners[e],this},e.prototype.removeAllEventListeners=function(e){return e==null&&(e=""),e===""?this._listeners={}:delete this._listeners[e],this},e.prototype.hasEventListener=function(e){return this._listeners[e]!=null},e.prototype.dispatchEvent=function(e,t){var n,r,i,s,o;t==null&&(t=null);if(!this.hasEventListener(e))return this;n=new a(e,this._target,t),o=this._listeners[e];for(i=0,s=o.length;i<s;i++)r=o[i],r.call(this._target,n);return this},e}(),y("jpp.event").register("EventDispatcher",f),i=function(){function e(){}return e.SLEEPING=0,e.EXECUTING=1,e.INTERRUPTING=2,e}(),y("jpp.command").register("CommandState",i),n=function(e){function t(e,n,r){e==null&&(e=null),n==null&&(n=null),r==null&&(r=null),t.__super__.constructor.call(this),this.setExecuteFunction(e),this.setInterruptFunction(n),this.setDestroyFunction(r),this._state=i.SLEEPING,this._self=this,this._parent=null}return P(t,e),t.prototype.execute=function(){return this._state>i.SLEEPING&&u["throw"]("Command.execute","Command is already executing."),this._state=i.EXECUTING,this.getExecuteFunction().call(this,this),this},t.prototype.interrupt=function(){return this._state===i.EXECUTING&&(this._state=i.INTERRUPTING,this.getInterruptFunction().call(this,this)),this},t.prototype.destroy=function(){return this._state=i.SLEEPING,this.getDestroyFunction().call(this,this),this._parent=null,this.__executeFunction=null,this.__interruptFunction=null,this.__destroyFunction=null,this},t.prototype.notifyComplete=function(){switch(this._state){case i.SLEEPING:return this;case i.EXECUTING:return this.dispatchEvent(a.COMPLETE),this.destroy(),this;case i.INTERRUPTING:return this.dispatchEvent(a.COMPLETE),this.destroy(),this}},t.prototype.getExecuteFunction=function(){var e;return(e=this.__executeFunction)!=null?e:this._executeFunction},t.prototype.setExecuteFunction=function(e){return this.__executeFunction=e,this},t.prototype.getInterruptFunction=function(){var e;return(e=this.__interruptFunction)!=null?e:this._interruptFunction},t.prototype.setInterruptFunction=function(e){return this.__interruptFunction=e,this},t.prototype.getDestroyFunction=function(){var e;return(e=this.__destroyFunction)!=null?e:this._destroyFunction},t.prototype.setDestroyFunction=function(e){return this.__destroyFunction=e,this},t.prototype.getState=function(){return this._state},t.prototype.getSelf=function(){return this._self},t.prototype.getParent=function(){return this._parent},t.prototype.setParent=function(e){return this._parent=e},t.prototype._executeFunction=function(e){return this.notifyComplete()},t.prototype._interruptFunction=function(e){},t.prototype._destroyFunction=function(e){},t}(f),y("jpp.command").register("Command",n),r=function(e){function t(){var e;e=1<=arguments.length?_.call(arguments,0):[],t.__super__.constructor.call(this),this._commands=[],this.addCommand.apply(this,e)}return P(t,e),t.prototype.addCommand=function(){var e;return e=1<=arguments.length?_.call(arguments,0):[],e.length>0&&(this._setParent(e),this._commands=this.getCommands().concat(e)),this},t.prototype.insertCommand=function(){var e,t;return t=arguments[0],e=2<=arguments.length?_.call(arguments,1):[],e.length>0&&(this._setParent(e),Array.prototype.splice.apply(this.getCommands(),[t,0].concat(e))),this},t.prototype.addCommandArray=function(e){return this.addCommand.apply(this,e),this},t.prototype.insertCommandArray=function(e,t){return this.insertCommand.apply(this,t),this},t.prototype._setParent=function(e){var t,n,r,i,s;n=0,s=[];for(r=0,i=e.length;r<i;r++)t=e[r],typeof t=="function"&&(e[n]=t=new l(t)),t.setParent(this),s.push(++n);return s},t.prototype.notifyBreak=function(){},t.prototype.notifyReturn=function(){},t.prototype.getCommandByIndex=function(e){return this._commands[e]},t.prototype.getCommands=function(){return this._commands},t.prototype.getLength=function(){return this._commands.length},t.prototype._executeFunction=function(e){return this.notifyComplete()},t.prototype._interruptFunction=function(e){},t.prototype._destroyFunction=function(e){return this._commands=[]},t}(n),y("jpp.command").register("CommandList",r),C=function(e){function t(){var e;e=1<=arguments.length?_.call(arguments,0):[],this._completeHandler=H(this._completeHandler,this),t.__super__.constructor.apply(this,e),this._currentCommand=null,this._position=0,this._isPaused=!1,this._isCompleteOnPaused=!1}return P(t,e),t.prototype.addCommand=function(){var e;return e=1<=arguments.length?_.call(arguments,0):[],t.__super__.addCommand.apply(this,e),this},t.prototype.insertCommand=function(){var e;return e=1<=arguments.length?_.call(arguments,0):[],t.__super__.insertCommand.apply(this,[this._position+1].concat(_.call(e))),this},t.prototype._next=function(){return this._currentCommand=this.getCommandByIndex(this._position),this._currentCommand.addEventListener(a.COMPLETE,this._completeHandler),this._currentCommand.execute()},t.prototype._completeHandler=function(e){return this._currentCommand.removeEventListener(a.COMPLETE,this._completeHandler),this._currentCommand=null,++this._position>=this.getLength()?this.notifyComplete():this._next()},t.prototype.notifyBreak=function(){var e;return((e=this._currentCommand)!=null?e.getState():void 0)===i.EXECUTING&&(this._currentCommand.removeEventListener(a.COMPLETE,this._completeHandler),this._currentCommand.interrupt()),this.notifyComplete()},t.prototype.notifyReturn=function(){var e,t;return((e=this._currentCommand)!=null?e.getState():void 0)===i.EXECUTING&&(this._currentCommand.removeEventListener(a.COMPLETE,this._completeHandler),this._currentCommand.interrupt()),(t=this.getParent())!=null&&t.notifyReturn(),this.destroy()},t.prototype.getPosition=function(){return this._position},t.prototype._executeFunction=function(e){return this._position=0,this.getLength()>0?this._next():this.notifyComplete()},t.prototype._interruptFunction=function(e){return this._currentCommand!=null&&(this._currentCommand.removeEventListener(a.COMPLETE,this._completeHandler),this._currentCommand.interrupt()),this._currentCommand=null,this._position=0,t.__super__._interruptFunction.call(this,e)},t.prototype._destroyFunction=function(e){return this._currentCommand!=null&&(this._currentCommand.removeEventListener(a.COMPLETE,this._completeHandler),this._currentCommand.destroy()),this._currentCommand=null,this._position=0,this._isPaused=!1,this._isCompleteOnPaused=!1,t.__super__._destroyFunction.call(this,e)},t}(r),y("jpp.command").register("Serial",C),E=function(e){function t(){var e;e=1<=arguments.length?_.call(arguments,0):[],this._completeHandler=H(this._completeHandler,this),t.__super__.constructor.apply(this,e),this._completeCount=0}return P(t,e),t.prototype.addCommand=function(){var e;return e=1<=arguments.length?_.call(arguments,0):[],t.__super__.addCommand.apply(this,e),this},t.prototype.insertCommand=function(){var e;return e=1<=arguments.length?_.call(arguments,0):[],t.__super__.insertCommand.apply(this,[this.getLength()].concat(_.call(e))),this},t.prototype._completeHandler=function(e){if(++this._completeCount>=this.getLength())return this.notifyComplete()},t.prototype.notifyBreak=function(){var e,t,n,r;r=this.getCommands();for(t=0,n=r.length;t<n;t++)e=r[t],e.getState()===i.EXECUTING&&(e.removeEventListener(a.COMPLETE,this._completeHandler),e.interrupt());return this.notifyComplete()},t.prototype.notifyReturn=function(){var e,t,n,r,s;r=this.getCommands();for(t=0,n=r.length;t<n;t++)e=r[t],e.getState()===i.EXECUTING&&(e.removeEventListener(a.COMPLETE,this._completeHandler),e.interrupt());return(s=this.getParent())!=null&&s.notifyReturn(),this.destroy()},t.prototype.getCompleteCount=function(){return this._completeCount},t.prototype._executeFunction=function(e){var t,n,r,i,s;this._completeCount=0,i=this.getCommands(),s=[];for(n=0,r=i.length;n<r;n++)t=i[n],t.addEventListener(a.COMPLETE,this._completeHandler),s.push(t.execute());return s},t.prototype._interruptFunction=function(e){var n,r,i,s;s=this.getCommands();for(r=0,i=s.length;r<i;r++)n=s[r],n.removeEventListener(a.COMPLETE,this._completeHandler),n.interrupt();return t.__super__._interruptFunction.call(this,e)},t.prototype._destroyFunction=function(e){var n,r,i,s;s=this.getCommands();for(r=0,i=s.length;r<i;r++)n=s[r],n.removeEventListener(a.COMPLETE,this._completeHandler),n.destroy();return this._completeCount=0,t.__super__._destroyFunction.call(this,e)},t}(r),y("jpp.command").register("Parallel",E),t=function(e){function t(){t.__super__.constructor.call(this)}return P(t,e),t.prototype._executeFunction=function(e){var t;return(t=this.getParent())!=null&&t.notifyBreak(),this.notifyComplete()},t.prototype._interruptFunction=function(e){},t.prototype._destroyFunction=function(e){},t}(n),y("jpp.command").register("Break",t),S=function(e){function t(){t.__super__.constructor.call(this)}return P(t,e),t.prototype._executeFunction=function(e){var t;return(t=this.getParent())!=null&&t.notifyReturn(),this.notifyComplete()},t.prototype._interruptFunction=function(e){},t.prototype._destroyFunction=function(e){},t}(n),y("jpp.command").register("Return",S),l=function(e){function t(e,n,r,i){e==null&&(e=null),n==null&&(n=[]),r==null&&(r=null),i==null&&(i=null),this._completeHandler=H(this._completeHandler,this),t.__super__.constructor.call(this),this._func=e,this._args=n,this._dispatcher=r,this._eventType=i}return P(t,e),t.prototype._completeHandler=function(e){return this.notifyComplete()},t.prototype.getFunction=function(){return this._func},t.prototype.setFunction=function(e){return this._func=e,this},t.prototype.getArguments=function(){return this._args},t.prototype.setArguments=function(e){return this._args=e,this},t.prototype._executeFunction=function(e){return this._dispatcher!=null&&this._eventType!=null?(this._dispatcher.addEventListener(this._eventType,this._completeHandler),typeof this._func=="function"?this._func.apply(this,this._args):void 0):(typeof this._func=="function"&&this._func.apply(this,this._args),this.notifyComplete())},t.prototype._interruptFunction=function(e){if(this._dispatcher!=null&&this._eventType!=null)return this._dispatcher.removeEventListener(this._eventType,this._completeHandler)},t.prototype._destroyFunction=function(e){return this._func=null,this._args=null,this._dispatcher=null,this._eventType=null},t}(n),y("jpp.command").register("Func",l),k=function(e){function t(e){t.__super__.constructor.call(this),this._message=e}return P(t,e),t.prototype.getMessage=function(){return this._message},t.prototype.setMessage=function(e){return this._message=e,this},t.prototype._executeFunction=function(e){return console.log(this._message),this.notifyComplete()},t.prototype._interruptFunction=function(e){},t.prototype._destroyFunction=function(e){return this._message=null},t}(n),y("jpp.command").register("Trace",k),O=function(e){function t(e){e==null&&(e=1),this._completeHandler=H(this._completeHandler,this),t.__super__.constructor.call(this),this._time=e,this._timeoutId=-1}return P(t,e),t.prototype._cancel=function(){return this._timeoutId!==-1&&clearTimeout(this._timeoutId),this._timeoutId=-1},t.prototype._completeHandler=function(e){return this.notifyComplete()},t.prototype.getTime=function(){return this._time},t.prototype.setTime=function(e){return this._time=e,this},t.prototype._executeFunction=function(e){return this._timeoutId=setTimeout(this._completeHandler,this._time*1e3)},t.prototype._interruptFunction=function(e){return this._cancel()},t.prototype._destroyFunction=function(e){return this._cancel()},t}(n),y("jpp.command").register("Wait",O),v=function(e){function t(e,n){e==null&&(e=null),n==null&&(n=null),this._handler=H(this._handler,this),t.__super__.constructor.call(this),this._type=e,this._dispatcher=n}return P(t,e),t.prototype._handler=function(e){return this.notifyComplete()},t.prototype.getType=function(){return this._type},t.prototype.setType=function(e){return this._type=e,this},t.prototype.getDispatcher=function(){return this._dispatcher},t.prototype.setDispatcher=function(e){return this._dispatcher=e,this},t.prototype._executeFunction=function(e){var t;if(this._type!=null)return(t=this._dispatcher)!=null?t.addEventListener(this._type,this._handler):void 0},t.prototype._interruptFunction=function(e){var t;if(this._type!=null)return(t=this._dispatcher)!=null?t.removeEventListener(this._type,this._handler):void 0},t.prototype._destroyFunction=function(e){var t;return this._type!=null&&(t=this._dispatcher)!=null&&t.removeEventListener(this._type,this._handler),this._type=null,this._dispatcher=null},t}(n),y("jpp.command").register("Listen",v),L=function(e){function t(e,n,r,i,s,u,a,f){r==null&&(r=null),i==null&&(i=1),s==null&&(s=o.Linear),u==null&&(u=null),a==null&&(a=null),f==null&&(f=null),this._intervalHandler=H(this._intervalHandler,this),t.__super__.constructor.call(this),this._target=e,this._to=n,this._from=r,this._time=i,this._easing=s,this._onStart=u,this._onUpdate=a,this._onComplete=f,this._intervalId=-1,this._tRatio=0,this._vRatio=0,this._startTime}return P(t,e),t.prototype._cancel=function(){return this._intervalId!==-1&&clearInterval(this._intervalId),this._intervalId=-1},t.prototype._apply=function(e){var t,n,r,i,s;this._tRatio=e,this._vRatio=this._easing(0,this._tRatio,0,1,1),i=this._to,s=[];for(t in i)r=i[t],n=this._from[t],s.push(this._target[t]=n+(r-n)*this._vRatio);return s},t.prototype._intervalHandler=function(e){var t;return t=((new Date).getTime()-this._startTime)/1e3,t<this._time?(this._apply(t/this._time),typeof this._onUpdate=="function"?this._onUpdate():void 0):(this._apply(1),typeof this._onUpdate=="function"&&this._onUpdate(),typeof this._onComplete=="function"&&this._onComplete(),this._cancel(),this.notifyComplete())},t.prototype.getTarget=function(){return this._target},t.prototype.setTarget=function(e){return this._target=e,this},t.prototype.getTo=function(){return this._to},t.prototype.setTo=function(e){return this._to=e,this},t.prototype.getFrom=function(){return this._from},t.prototype.setFrom=function(e){return this._from=e,this},t.prototype.getTime=function(){return this._time},t.prototype.setTime=function(e){return this._time=e,this},t.prototype.getEasing=function(){return this._easing},t.prototype.setEasing=function(e){return this._easing=e,this},t.prototype.getOnStart=function(){return this._onStart},t.prototype.setOnStart=function(e){return this._onStart=e,this},t.prototype.getOnUpdate=function(){return this._onUpdate},t.prototype.setOnUpdate=function(e){return this._onUpdate=e,this},t.prototype.getOnComplete=function(){return this._onComplete},t.prototype.setOnComplete=function(e){return this._onComplete=e,this},t.prototype.getRatio=function(){return this._vRatio},t.prototype.getTimeRatio=function(){return this._tRatio},t.prototype._executeFunction=function(e){var t,n,r,i,s,o;(i=this._from)==null&&(this._from={}),s=this._to;for(t in s)n=s[t],(o=(r=this._from)[t])==null&&(r[t]=this._target[t]);return this._time>0?(this._intervalId=setInterval(this._intervalHandler,10),this._startTime=(new Date).getTime(),this._apply(0),typeof this._onStart=="function"?this._onStart():void 0):(this._apply(0),typeof this._onStart=="function"&&this._onStart(),this._apply(1),typeof this._onUpdate=="function"&&this._onUpdate(),typeof this._onComplete=="function"&&this._onComplete(),this.notifyComplete())},t.prototype._interruptFunction=function(e){return this._cancel()},t.prototype._destroyFunction=function(e){return this._cancel()},t}(n),y("jpp.command").register("Tween",L),c=function(e){function t(e){e==null&&(e=null),this._completeHandler=H(this._completeHandler,this),t.__super__.constructor.call(this),this._options=e!=null?e:{},this._status="",this._isSucceed=!1}return P(t,e),t.prototype._completeHandler=function(e,t){var n;console.log(this),this._status=t,this._isSucceed=t==="success",typeof (n=this._options).complete=="function"&&n.complete(e,t);if(this.getState()===i.EXECUTING)return this.notifyComplete()},t.prototype.getOptions=function(){return this._options},t.prototype.setOptions=function(e){return this._options=e,this},t.prototype.getUrl=function(){return this._options.url},t.prototype.setUrl=function(e){return this._options.url=e,this},t.prototype.getMethod=function(){return this._options.type},t.prototype.setMethod=function(e){return this._options.type=e,this},t.prototype.getData=function(){return this._options.data},t.prototype.setData=function(e){return this._options.data=e,this},t.prototype.getDataType=function(){return this._options.dataType},t.prototype.setDataType=function(e){return this._options.dataType=e,this},t.prototype.getOnSuccess=function(){return this._options.success},t.prototype.setOnSuccess=function(e){return this._options.success=e,this},t.prototype.getOnError=function(){return this._options.error},t.prototype.setOnError=function(e){return this._options.error=e,this},t.prototype.getOnComplete=function(){return this._options.complete},t.prototype.setOnComplete=function(e){return this._options.complete=e,this},t.prototype.getStatus=function(){return this._status},t.prototype.getIsSucceed=function(){return this._isSucceed},t.prototype._executeFunction=function(e){var t,n,r,i;n={},i=this._options;for(t in i)r=i[t],n[t]=r;return n.complete=this._completeHandler,jQuery.ajax(n)},t.prototype._interruptFunction=function(e){return this},t.prototype._destroyFunction=function(e){return this._options=null,this._status="",this._isSucceed=!1},t}(n),y("jpp.command").register("JqueryAjax",c),p=function(e){function t(e,n,r,i,s){e==null&&(e=null),n==null&&(n=null),r==null&&(r=null),i==null&&(i=null),s==null&&(s=null),t.__super__.constructor.call(this,{type:"get",url:e,data:n,success:r,error:i,dataType:s})}return P(t,e),t}(c),y("jpp.command").register("JqueryGet",p),d=function(e){function t(e,n,r,i,s){e==null&&(e=null),n==null&&(n=null),r==null&&(r=null),i==null&&(i=null),s==null&&(s=null),t.__super__.constructor.call(this,{type:"post",url:e,data:n,success:r,error:i,dataType:s})}return P(t,e),t}(c),y("jpp.command").register("JqueryPost",d),h=function(e){function t(e,n,r){r==null&&(r=null),this._completeHandler=H(this._completeHandler,this),t.__super__.constructor.call(this),this._target=e,this._params=n,this._options=r,this._isTweening=!1}return P(t,e),t.prototype._completeHandler=function(){var e;return e=1<=arguments.length?_.call(arguments,0):[],this._isTweening=!1,this._originalComplete!==null&&this._originalComplete.apply(this._target,e),this.notifyComplete()},t.prototype._cancel=function(){if(!this._isTweening)return;return this._isTweening=!1,this._target.stop()},t.prototype.getTarget=function(){return this._target},t.prototype.setTarget=function(e){return this._target=e,this},t.prototype.getParams=function(){return this._params},t.prototype.setParams=function(e){return this._params=e,this},t.prototype.getOptions=function(){return this._options},t.prototype.setOptions=function(e){return this._options=e,this},t.prototype._executeFunction=function(e){var t,n;if(this._isTweening)return;return this._isTweening=!0,this._originalComplete=(n=this._options.complete)!=null?n:null,t=w.clone(this._options),t.complete=this._completeHandler,this._target.animate(this._params,t)},t.prototype._interruptFunction=function(e){return this._cancel()},t.prototype._destroyFunction=function(e){return this._cancel()},t}(n),y("jpp.command").register("JqueryAnimate",h),s=function(e){function t(e){this._completeHandler=H(this._completeHandler,this),t.__super__.constructor.call(this),this._tweenProvider=e}return P(t,e),t.prototype._completeHandler=function(e){return this._cancel(),this.notifyComplete()},t.prototype._cancel=function(){return this._tween.pause(this._tween)},t.prototype.getTween=function(){return this._tween},t.prototype.setTween=function(e){return this._tween=e,this},t.prototype._executeFunction=function(e){return this._tween=this._tweenProvider(),this._tween.loop=!1,this._tween.call(this._completeHandler),this._tween.play(this._tween)},t.prototype._interruptFunction=function(e){return this._cancel()},t.prototype._destroyFunction=function(e){return this._cancel()},t}(n),y("jpp.command").register("DoTweenJS",s),m=function(e){function t(e){this._sceneChangeStatusHandler=H(this._sceneChangeStatusHandler,this),this._kazitoriExecutedHandler=H(this._kazitoriExecutedHandler,this),this._kazitoriRoutingNotFoundHandler=H(this._kazitoriRoutingNotFoundHandler,this),this._kazitoriRoutingHandler=H(this._kazitoriRoutingHandler,this);var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m=this;t.__super__.constructor.call(this,this),this._isReleaseMode=(c=e.isReleaseMode)!=null?c:!0,this._log=A.log,this._queue=[],this._queuePosition=-1,this._direction=[],this._targetFragment=null,this._currentScene=null,this._isInGeneratingSubFragment=!1,this._isRunning=!1,this._isFirstRequest=!0,this._scenes={},this.root=(h=e.root)!=null?h:this.root,this.rootFile=(p=e.rootFile)!=null?p:this.rootFile,this.routes=(d=e.routes)!=null?d:this.routes,s={},r=function(e,t){return function(){var n;return n=1<=arguments.length?_.call(arguments,0):[],m._kazitoriRoutingHandler(e,t,n)}},v=this.routes;for(o in v)u=v[o],s[o]=r(o,u);for(o in this.routes){n=A.decompseFragment(o).route;for(f=0,l=n.length;f<l;f++)a=n[f],s[a]===void 0&&(s[a]=r(a,null))}i={},i.root=this.root,i.rootFile=this.rootFile,i.routes=s,i.isAutoStart=!1,i.notFound=function(){var e;return e=1<=arguments.length?_.call(arguments,0):[],m._kazitoriRoutingNotFoundHandler(e)},this._kazitori=new Kazitori(i),this._kazitori.addEventListener(KazitoriEvent.EXECUTED,this._kazitoriExecutedHandler),A.LOGGING=!0,A.printInit(this._kazitori,this.routes),this.onInit(),this._kazitori.start()}return P(t,e),t.VERSION="0.1.0",t.prototype.goto=function(e){return this._log("goto : '"+e+"'"),this._kazitori.change(e)},t.prototype.next=function(){return this._log("next"),this._kazitori.torikazi()},t.prototype.prev=function(){return this._log("prev"),this._kazitori.omokazi()},t.prototype.getScene=function(e){var t,n;return this._log("get scene : '"+e+"'"),t=this._scenes[e],t===void 0&&(this._log("get scene temporary : '"+e+"'"),this._isInGeneratingSubFragment=!0,n=this._kazitori.fragment,this._kazitori.fragment=e,this._kazitori.executeHandlers(),this._kazitori.fragment=n,this._isInGeneratingSubFragment=!1,t=this._scenes[e]),t.getIsInitialized()===!1&&A.error("初期化されていないシーン'"+e+"'が呼び出されました"),t},t.prototype.onInit=function(){},t.prototype.onSceneRequest=function(e,t){return x},t.prototype._kazitoriRoutingHandler=function(e,t,n){var r,i;r=this._kazitori.fragment,i=this._scenes[r];if(i===void 0){this._log("create new Scene of '"+r+"'");if(t===null){this._log("request Scene of '"+r+"'"),t=this.onSceneRequest(r,n);if(t===void 0||t===null)this._log("default Scene of '"+r+"'"),t=x}i=new t(this,e,r,n),i.init(),this._scenes[r]=i}return this._log("kazitoriRoutingHandler : rule     = "+i.getRule()),this._log("kazitoriRoutingHandler : fragment = "+i.getFragment()),this._log("kazitoriRoutingHandler : params   = ["+i.getParams().join(", ")+"]")},t.prototype._kazitoriRoutingNotFoundHandler=function(e){return this._log("404 :"+e.join(", "))},t.prototype._kazitoriExecutedHandler=function(e){var t,n,r,i;if(this._isInGeneratingSubFragment)return;if(this._isFirstRequest&&e.next===this.root)return;return this._isFirstRequest=!1,r=e.next,this._targetFragment===null?n=A.decompseFragment(r):n=A.complementFragment(this._targetFragment,r),i=n.route,t=n.direction,this._pushRoute(i,t)},t.prototype._pushRoute=function(e,t){var n;return e===null?!1:e.length===0?!1:e[e.length-1]===this._targetFragment?!1:(n=this._targetFragment,this._targetFragment=e[e.length-1],this._queue=this._queue.slice(0,this._queuePosition).concat(e),this._direction=this._direction.slice(0,this._queuePosition).concat(t),this._log("pushRoute : queue = '"+this._queue.join("' -> '")+"'"),this._log("pushRoute : direction = '"+this._direction.join("' -> '")+"'"),this._log("pushRoute : position = "+this._queuePosition),this._log("change : route = '"+e.join("' -> '")+"'"),this.dispatchEvent(g.CHANGE,{prev:n,next:this._targetFragment}),this._startAsync(),!0)},t.prototype._startAsync=function(){return this._isRunning?!1:this._currentScene===null?(this._log("start async process : first"),this._nextAsync()):this._currentScene.getStatus()===N.STAY?(this._log("start async process : leave"),this._currentScene.addEventListener(T.CHANGE_STATUS,this._sceneChangeStatusHandler),this._currentScene.leave()):this._getNextDirection()<0?(this._log("start async process : bye"),this._currentScene.addEventListener(T.CHANGE_STATUS,this._sceneChangeStatusHandler),this._currentScene.bye()):(this._log("start async process : next"),this._nextAsync())},t.prototype._nextAsync=function(){var e,t,n;return this._log("next async process : first"),(n=this._currentScene)!=null&&n.removeEventListener(T.CHANGE_STATUS,this._sceneChangeStatusHandler),e=this._getNextDirection(),++this._queuePosition,t=this._queue[this._queuePosition],this._currentScene=this.getScene(t),e>=0?(this._currentScene.addEventListener(T.CHANGE_STATUS,this._sceneChangeStatusHandler),this._currentScene.hello()):this._queuePosition===this._queue.length-1?(this._currentScene.addEventListener(T.CHANGE_STATUS,this._sceneChangeStatusHandler),this._currentScene.arrive()):this._nextAsync()},t.prototype._sceneChangeStatusHandler=function(e){if(!e.extra.isComplete)return this._isRunning=!0;this._isRunning=!1,this._currentScene.removeEventListener(T.CHANGE_STATUS,this._sceneChangeStatusHandler);switch(e.extra.status){case N.HELLO:return this._queuePosition===this._queue.length-1?(this._currentScene.addEventListener(T.CHANGE_STATUS,this._sceneChangeStatusHandler),this._currentScene.arrive()):this._getNextDirection()>0?this._nextAsync():(this._currentScene.addEventListener(T.CHANGE_STATUS,this._sceneChangeStatusHandler),this._currentScene.bye());case N.ARRIVE:if(this._queuePosition<this._queue.length-1)return this._currentScene.addEventListener(T.CHANGE_STATUS,this._sceneChangeStatusHandler),this._currentScene.leave();break;case N.LEAVE:return this._getNextDirection()>0?this._nextAsync():(this._currentScene.addEventListener(T.CHANGE_STATUS,this._sceneChangeStatusHandler),this._currentScene.bye());case N.BYE:return this._nextAsync()}},t.prototype._getNextDirection=function(){return this._queuePosition<0?1:this._queuePosition===this._queue.length-1?0:A.getDirection(this._queue[this._queuePosition],this._queue[this._queuePosition+1])},t}(f),y("jpp.milkpack").register("Milkpack",m),g=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return P(t,e),t.INIT="init",t.CHANGE="change",t}(a),y("jpp.milkpack").register("MilkpackEvent",g),x=function(e){function t(e,n,r,i){this._onBye=H(this._onBye,this),this._onLeave=H(this._onLeave,this),this._onArrive=H(this._onArrive,this),this._onHello=H(this._onHello,this),this._onInit=H(this._onInit,this),this._getBye=H(this._getBye,this),this._getLeave=H(this._getLeave,this),this._getArrive=H(this._getArrive,this),this._getHello=H(this._getHello,this),this._commandCompleteHandler=H(this._commandCompleteHandler,this),t.__super__.constructor.call(this,this),this._manager=e,this._rule=n,this._fragment=r,this._params=i,this.self=this,this._title=null,this._status=N.GONE,this._isInitialized=!1,this._command=null,this._commandWrapper=null,this.__commandsHello=[],this.__commandsArrive=[],this.__commandsLeave=[],this.__commandsBye=[]}return P(t,e),t.self=null,t.prototype.init=function(){if(this._isInitialized)return;return this._isInitialized=!0,this._onInit()},t.prototype.hello=function(){return this._switchStatus(N.HELLO,this._getHello)},t.prototype.arrive=function(){return this._switchStatus(N.ARRIVE,this._getArrive)},t.prototype.leave=function(){return this._switchStatus(N.LEAVE,this._getLeave)},t.prototype.bye=function(){return this._switchStatus(N.BYE,this._getBye)},t.prototype.addCommand=function(){var e,t;e=1<=arguments.length?_.call(arguments,0):[];if(this._commandWrapper!==null)return(t=this._commandWrapper).addCommand.apply(t,e)},t.prototype.insertCommand=function(){var e,t;e=1<=arguments.length?_.call(arguments,0):[];if(this._commandWrapper!==null)return(t=this._commandWrapper).insertCommand.apply(t,e)},t.prototype._switchStatus=function(e,t){if(this._command!==null){A.log("Command is being executed (status = "+this._status+")");return}return this._clearCommand(),this._status=e,this._dispatchStatusEvent(this._status,!1),this._command=t(),this._command.addEventListener(a.COMPLETE,this._commandCompleteHandler),this._command.execute()},t.prototype._clearCommand=function(){if(this._command!==null)return this._command.removeEventListener(a.COMPLETE,this._commandCompleteHandler),this._command.interrupt(),this._command=null},t.prototype._commandCompleteHandler=function(e){var t;this._clearCommand(),t=this._status;switch(this._status){case N.ARRIVE:this._status=N.STAY;break;case N.BYE:this._status=N.GONE}return this._dispatchStatusEvent(t,!0)},t.prototype._dispatchStatusEvent=function(e,t){return A.log("Scene '"+this._fragment+"' : "+e+" "+(t?"End":"Begin")),this.dispatchEvent(T.CHANGE_STATUS,{status:e,isComplete:t})},t.prototype._getCommandInternal=function(e,t){return this._commandWrapper=new C,this.__commandsHello.length===0?e():this._commandWrapper.addCommandArray(t),this._commandWrapper},t.prototype.getIsInitialized=function(){return this._isInitialized},t.prototype.getManager=function(){return this._manager},t.prototype.getRule=function(){return this._rule},t.prototype.getFragment=function(){return this._fragment},t.prototype.getParams=function(){return this._params},t.prototype.getStatus=function(){return this._status},t.prototype._getHello=function(){return this._getCommandInternal(this._onHello,this.__commandsHello)},t.prototype.setHello=function(){var e;return e=1<=arguments.length?_.call(arguments,0):[],this.__commandsHello=e,this},t.prototype._getArrive=function(){return this._getCommandInternal(this._onArrive,this.__commandsArrive)},t.prototype.setArrive=function(){var e;return e=1<=arguments.length?_.call(arguments,0):[],this.__commandsArrive=e,this},t.prototype._getLeave=function(){return this._getCommandInternal(this._onLeave,this.__commandsLeave)},t.prototype.setLeave=function(){var e;return e=1<=arguments.length?_.call(arguments,0):[],this.__commandsLeave=e,this},t.prototype._getBye=function(){return this._getCommandInternal(this._onBye,this.__commandsBye)},t.prototype.setBye=function(){var e;return e=1<=arguments.length?_.call(arguments,0):[],this.__commandsBye=e,this},t.prototype.getTitle=function(){return this._title},t.prototype.setTitle=function(e){return this._title=e},t.prototype._onInit=function(){},t.prototype._onHello=function(){},t.prototype._onArrive=function(){},t.prototype._onLeave=function(){},t.prototype._onBye=function(){},t}(f),y("jpp.milkpack").register("Scene",x),T=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return P(t,e),t.CHANGE_STATUS="chanegStatus",t}(a),y("jpp.milkpack").register("SceneEvent",T),N=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return P(t,e),t.HELLO="hello",t.ARRIVE="arrive",t.STAY="stay",t.LEAVE="leave",t.BYE="bye",t.GONE="gone",t}(a),y("jpp.milkpack").register("SceneStatus",N),A=function(){function e(){}return e.LOGGING=!0,e.decompseFragment=function(e){var t,n,r,i,s,o,u;if(e===null||e===""||e==="/")return{route:["/"],direction:!0};r=e.split("/"),t=[],i="",n=0;for(o=0,u=r.length;o<u;o++)s=r[o],i+=i==="/"?s:"/"+s,r[n]=i,t[n]=!0,++n;return{route:r,direction:t}},e.complementFragment=function(t,n){var r,i,s,o,u,a,f;f=[],i=[],t==null&&(t=""),n==null&&(n=""),t.charAt(0)==="/"&&(t=t.substr(1)),n.charAt(0)==="/"&&(n=n.substr(1)),a=e.decompseFragment(t).route,u=e.decompseFragment(n).route,o=Math.min(a.length,u.length),r=0;while(r<o){if(a[r]!==u[r])break;++r}o=r,s=a.length-1;while(s>=o)f.push(a[s]),i.push(!1),--s;o=u.length-1,s=r;while(s<=o)f.push(u[s]),i.push(!0),++s;return{route:f,direction:i}},e.getDirection=function(e,t){var n,r,i,s,o,u;if(e===t)return 0;n=e==="/"?[""]:e.split("/"),i=t==="/"?[""]:t.split("/"),r=n.length,s=i.length,u=Math.min(r,s),o=1;while(o<u){if(n[o]!==i[o])break;++o}return r===s&&o===r-1?0:o===r&&o<s?1:-1},e.log=function(){var t;t=1<=arguments.length?_.call(arguments,0):[];if(e.LOGGING)return console.log("[Comppass] "+t.join(" "))},e.error=function(){var e;return e=1<=arguments.length?_.call(arguments,0):[],console.log("[Comppass Error] "+e.join(" "))},e.printInit=function(t,n){var r,i,s;if(!e.LOGGING)return;s=[];for(r in n)i=n[r],s.push("           '"+r+"'");return e.log("----------------------------------------"),e.log("Milkpack "+m.VERSION+"  © Copyright alumican.net All rights reserved."),e.log("Kazitori "+t.VERSION+"  © Copyright hageee.net All rights reserved."),e.log("root: "+t.root),e.log("routes: \n"+s.join("\n")),e.log("----------------------------------------")},e}(),y("jpp.milkpack").register("Util",A)}).call(this);